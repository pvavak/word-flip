<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Word Flip – EN↔SK tréning</title>
<style>
body{font-family:system-ui;margin:0;background:#f7f8ff;color:#1f2937}
.wrap{max-width:1000px;margin:auto;padding:20px}
.card{background:#fff;padding:16px;border-radius:14px;margin-bottom:15px}
button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer}
.opt{display:block;width:100%;margin:6px 0;padding:12px;border:1px solid #ddd;border-radius:10px;background:#fff}
.opt.correct{background:#d1fae5}
.opt.wrong{background:#fee2e2}
.btnSmall{font-size:12px;padding:6px 10px;margin-left:10px}
</style>
</head>
<body>
<div class="wrap">
<h2>Word Flip – EN↔SK tréning</h2>

<div class="card">
<select id="packSelect">
<option value="all">Všetko</option>
<option value="mistakes">Tréning chýb</option>
<option value="colors">Farby</option>
<option value="numbers">Čísla</option>
<option value="family">Rodina</option>
<option value="school">Škola</option>
<option value="food">Jedlo</option>
<option value="animals">Zvieratá</option>
<option value="travel">Cestovanie</option>
<option value="jobs">Povolania</option>
<option value="restaurant">Reštaurácia</option>
<option value="description">Opis osoby</option>
</select>

<button onclick="startGame()">Spustiť hru</button>
<button onclick="clearMistakes()" class="btnSmall">Vymaž chyby</button>
<div id="scoreBox">Skóre: 0</div>
</div>

<div class="card">
<div id="question"></div>
<div id="options"></div>
</div>

</div>

<script>

const STORAGE_MISTAKES = 'wordflip_mistakes_v2';

const CONFUSION_SETS = {
cola:['color','cold'],
burger:['pizza','pasta'],
rice:['pasta','bread'],
tall:['thin','short'],
short:['tall','small'],
curly:['straight','wavy'],
left:['right'],
doctor:['nurse','teacher']
};

function grammarVariants(text){
let variants=[];
if(text.includes("He’s")) variants.push(text.replace("He’s","He is"));
if(text.includes("She’s")) variants.push(text.replace("She’s","She is"));
if(text.includes("I’d")) variants.push(text.replace("I’d","I would"));
return variants;
}

function singularPluralVariants(text){
let variants=[];
if(!text.includes(" ")){
if(text.endsWith("s")) variants.push(text.slice(0,-1));
else variants.push(text+"s");
}
return variants;
}

const VOCAB_PACKS = {
colors:[
{en:'red',sk:'červená',cat:'color'},
{en:'blue',sk:'modrá',cat:'color'},
{en:'green',sk:'zelená',cat:'color'},
{en:'yellow',sk:'žltá',cat:'color'}
],
food:[
{en:'burger',sk:'burger',cat:'main'},
{en:'pizza',sk:'pizza',cat:'main'},
{en:'pasta',sk:'cestoviny',cat:'main'},
{en:'rice',sk:'ryža',cat:'main'},
{en:'cola',sk:'kola',cat:'drink'},
{en:'milkshake',sk:'mliečny kokteil',cat:'drink'}
],
description:[
{en:'tall',sk:'vysoký',cat:'appearance'},
{en:'short',sk:'nízky',cat:'appearance'},
{en:'curly hair',sk:'kučeravé vlasy',cat:'hair'},
{en:'long hair',sk:'dlhé vlasy',cat:'hair'}
]
};

const PHRASES=[
{en:'He’s tall.',sk:'On je vysoký.',cat:'sentence'},
{en:'I’d like a burger, please.',sk:'Dal by som si burger.',cat:'sentence'}
];

let pool=[];
let score=0;

function startGame(){
score=0;
document.getElementById("scoreBox").innerText="Skóre: 0";
let pack=document.getElementById("packSelect").value;

if(pack==="mistakes"){
pool=JSON.parse(localStorage.getItem(STORAGE_MISTAKES)||"[]");
}else if(pack==="all"){
pool=Object.values(VOCAB_PACKS).flat().concat(PHRASES);
}else{
pool=(VOCAB_PACKS[pack]||[]);
}
nextQuestion();
}

function nextQuestion(){
if(pool.length===0){alert("Hotovo");return;}
let q=pool[Math.floor(Math.random()*pool.length)];
current=q;
document.getElementById("question").innerText=q.en;

let answer=q.sk;
let options=[answer];
let used=new Set([answer]);

grammarVariants(answer).forEach(v=>{
if(options.length<4 && !used.has(v)){options.push(v);used.add(v);}
});

singularPluralVariants(answer).forEach(v=>{
if(options.length<4 && !used.has(v)){options.push(v);used.add(v);}
});

let key=q.en.toLowerCase();
if(CONFUSION_SETS[key]){
CONFUSION_SETS[key].forEach(v=>{
if(options.length<4 && !used.has(v)){options.push(v);used.add(v);}
});
}

while(options.length<4){
let r=pool[Math.floor(Math.random()*pool.length)];
if(r.sk && !used.has(r.sk)){
options.push(r.sk);
used.add(r.sk);
}
}

options.sort(()=>Math.random()-0.5);

let html="";
options.forEach(opt=>{
html+=`<button class="opt" onclick="checkAnswer(this,'${opt}','${answer}')">${opt}</button>`;
});
document.getElementById("options").innerHTML=html;
}

function checkAnswer(btn,choice,correct){
if(choice===correct){
btn.classList.add("correct");
score++;
}else{
btn.classList.add("wrong");

let saved=JSON.parse(localStorage.getItem(STORAGE_MISTAKES)||"[]");
if(!saved.find(x=>x.en===current.en)){
saved.push(current);
localStorage.setItem(STORAGE_MISTAKES,JSON.stringify(saved));
}
}

document.getElementById("scoreBox").innerText="Skóre: "+score;
setTimeout(nextQuestion,1000);
}

function clearMistakes(){
localStorage.removeItem(STORAGE_MISTAKES);
alert("Chyby vymazané");
}

</script>
</body>
</html>
